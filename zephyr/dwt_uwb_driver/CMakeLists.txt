# SPDX-License-Identifier: Apache-2.0

if(CONFIG_FPU)
    if(CONFIG_SOC_SERIES_NRF53X)
        if(CONFIG_DW3000_DRIVER_6_0_14)
            message( SEND_ERROR "Library DW3000 6.0.14 not available in NRF53")
        else()
            set(DWTINCPATH inc_6.0.7)
            set(DWTLIBNAME libdwt_uwb_driver-m33-hfp-6.0.7.a)
        endif()
    else()
        if(CONFIG_DW3000_DRIVER_6_0_14)
            set(DWTINCPATH inc_6.0.14)
            set(DWTLIBNAME libdwt_uwb_driver-m4-hfp-6.0.14.a)
        else()
            set(DWTINCPATH inc_6.0.7)
            set(DWTLIBNAME libdwt_uwb_driver-m4-hfp-6.0.7.a)
        endif()
    endif()
else()
    if(CONFIG_SOC_SERIES_NRF53X)
        if(CONFIG_DW3000_DRIVER_6_0_14)
            message( SEND_ERROR "Library DW3000 6.0.14 not available in NRF53")
        else()
            set(DWTINCPATH inc_6.0.7)
            set(DWTLIBNAME libdwt_uwb_driver-m33-sfp-6.0.7.a)
        endif()
    else()
        if(CONFIG_DW3000_DRIVER_6_0_14)
            set(DWTINCPATH inc_6.0.14)
            set(DWTLIBNAME libdwt_uwb_driver-m4-sfp-6.0.14.a)
        else()
            set(DWTINCPATH inc_6.0.7)
            set(DWTLIBNAME libdwt_uwb_driver-m4-sfp-6.0.7.a)
        endif()
    endif()
endif()

# use zephyr_library_import in order to get it linked with the
# -Wl,--whole-archive flag (keep all symbols)
zephyr_library_import(dwtlib ${CMAKE_CURRENT_SOURCE_DIR}/lib/${DWTLIBNAME})

zephyr_include_directories(${DWTINCPATH})

# the library needs a custom linker script
zephyr_linker_sources(SECTIONS custom-sections.ld)
